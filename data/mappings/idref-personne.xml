<?xml version="1.0" encoding="UTF-8"?>
<!--
    IdRef Personne (Person) mapping for Omeka S.
    Converts Unimarc XML from IdRef authority records to Omeka resource format.

    @see https://www.idref.fr
    @see http://documentation.abes.fr/aideidrefdeveloppeur/index.html
-->
<mapping>
    <info>
        <label>IdRef - Personne</label>
        <from>xml</from>
        <to>omeka</to>
        <querier>xpath</querier>
    </info>

    <tables>
        <!-- Gender lookup table -->
        <table name="gender">
            <entry key="0">FÃ©minin</entry>
            <entry key="1">Masculin</entry>
        </table>
    </tables>

    <maps>
        <!-- Static: Resource class (foaf:Person) -->
        <map>
            <to field="o:resource_class" datatype="resource:class"/>
            <mod raw="foaf:Person"/>
        </map>

        <!-- Static: Resource template -->
        <map>
            <to field="o:resource_template" datatype="resource:template"/>
            <mod raw="Personne"/>
        </map>

        <!-- foaf:name - Full name from 900$a -->
        <map>
            <from xpath="/record/datafield[@tag='900']/subfield[@code='a']"/>
            <to field="foaf:name"/>
        </map>

        <!-- foaf:familyName - Family name from 200$a -->
        <map>
            <from xpath="/record/datafield[@tag='200']/subfield[@code='a']"/>
            <to field="foaf:familyName"/>
        </map>

        <!-- foaf:givenName - Given name from 200$b -->
        <map>
            <from xpath="/record/datafield[@tag='200']/subfield[@code='b']"/>
            <to field="foaf:givenName"/>
        </map>

        <!-- bio:birth - Birth date from 103$a (Unimarc format YYYYMMDD) -->
        <map>
            <from xpath="/record/datafield[@tag='103']/subfield[@code='a'][1]"/>
            <to field="bio:birth" datatype="numeric:timestamp"/>
            <mod pattern="{{ value|dateIso }}"/>
        </map>

        <!-- bio:death - Death date from 103$b -->
        <map>
            <from xpath="/record/datafield[@tag='103']/subfield[@code='b'][1]"/>
            <to field="bio:death" datatype="numeric:timestamp"/>
            <mod pattern="{{ value|dateIso }}"/>
        </map>

        <!-- dcterms:language - Language from 101$a with LOC vocabulary URI -->
        <map>
            <from xpath="/record/datafield[@tag='101']/subfield[@code='a'][1]"/>
            <to field="dcterms:language" datatype="valuesuggest:lc:iso6392"/>
            <mod pattern="http://id.loc.gov/vocabulary/iso639-2/{{ value }}"/>
        </map>

        <!-- bio:place - Country from 102$a (requires geonames lookup) -->
        <!-- Note: code_to_geonames conversion handled by custom filter -->
        <map>
            <from xpath="/record/datafield[@tag='102']/subfield[@code='a'][1]"/>
            <to field="bio:place" datatype="valuesuggest:geonames:geonames"/>
            <mod pattern="{{ value|table(geonames) }}"/>
        </map>

        <!-- bio:position - Position/function from 200$c -->
        <map>
            <from xpath="/record/datafield[@tag='200']/subfield[@code='c'][1]"/>
            <to field="bio:position"/>
        </map>

        <!-- bio:biography - Biography from 340$a -->
        <map>
            <from xpath="/record/datafield[@tag='340']/subfield[@code='a'][1]"/>
            <to field="bio:biography"/>
        </map>

        <!-- bibo:identifier - IdRef URI from controlfield 003 -->
        <map>
            <from xpath="/record/controlfield[@tag='003']"/>
            <to field="bibo:identifier" datatype="valuesuggest:idref:person"/>
        </map>
    </maps>
</mapping>
